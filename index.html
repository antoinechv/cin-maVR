<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Forest Gump</title>
    <script src="https://aframe.io/releases/1.6.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/n5ro/aframe-physics-system@v4.0.1/dist/aframe-physics-system.min.js"></script>
</head>
<body>
<a-scene physics="debug: false" fog="type: exponential; color: white; density: 0.2">

    <a-assets>
        <!-- Modèles 3D -->
        <a-asset-item id="Bench" src="./models/Bench.glb"></a-asset-item>
        <a-asset-item id="Valise" src="./models/Valise.glb"></a-asset-item>
        <a-asset-item id="Box" src="./models/Box.glb"></a-asset-item>
        <a-asset-item id="feather-model" src="./models/plume.glb"></a-asset-item> <!-- Plume 3D -->
        <!-- Audios -->
        <audio id="bench-music" src="./audio/theme.mp3" preload="auto"></audio>
        <audio id="box-music" src="./audio/box.mp3" preload="auto"></audio>
        <audio id="valise-music" src="./audio/valise.mp3" preload="auto"></audio>
    </a-assets>

    <a-sky color="white"></a-sky>
    <!-- Lumières -->
    <a-light type="ambient" color="#ffffff" intensity="0.5"></a-light>

    <!-- Caméra avec corps dynamique -->
    <a-entity id="rig" position="0.2 1 6" dynamic-body move-forward-only>
        <a-camera id="camera" camera="look-controls: true;" movement-controls="enabled: true; userHeight: true;">
            <a-cursor id="cursor" position="0 0 -1" material="color: red; shader: flat;"></a-cursor>
        </a-camera>
    </a-entity>

    <!-- Scène principale -->
    <a-entity>
        <!-- Banc -->
        <a-entity id="Bench"
                  gltf-model="#Bench"
                  position="0.8 1 -2"
                  scale="0.2 0.1 0.1"
                  class="clickable"
                  cursor-listener>
        </a-entity>

        <!-- Valise -->
        <a-entity id="Valise"
                  gltf-model="#Valise"
                  position="0.8 0.3 -15"
                  rotation="0 120 0"
                  scale="0.15 0.15 0.15"
                  class="clickable"
                  cursor-listener>
        </a-entity>

        <!-- Boîte de chocolat -->
        <a-entity id="Box"
                  gltf-model="#Box"
                  position="1.4 1.05 -23"
                  rotation="0 30 0"
                  scale="0.5 0.5 0.5"
                  class="clickable"
                  cursor-listener>
        </a-entity>
    </a-entity>

    <!-- Plumes tombant en boucle -->
    <a-entity gltf-model="#feather-model"
              id="feather1"
              position="0 5 -30"
              dynamic-body="mass: 0.1"
              animation="property: position; to: 0 0 -30; dur: 3000; loop: true; dir: normal;">
    </a-entity>

</a-scene>

<script>
    // Ajoute un listener pour chaque objet qui déclenche la musique quand le curseur entre dans l'objet
    AFRAME.registerComponent('cursor-listener', {
        init: function () {
            var el = this.el;
            var music;

            // Détection de l'entrée du curseur
            el.addEventListener('mouseenter', function () {
                if (el.id === 'Bench') {
                    music = document.querySelector('#bench-music');
                    music.volume = 0.1;  // Baisse le volume à 10%
                } else if (el.id === 'Valise') {
                    music = document.querySelector('#valise-music');
                } else if (el.id === 'Box') {
                    music = document.querySelector('#box-music');
                    music.volume = 1;
                }

                if (music) {
                    music.play();
                }
            });
        }
    });

    // Limitons les déplacements à l'avant avec le contrôleur
    // Composant personnalisé pour limiter les mouvements uniquement vers l'avant
    AFRAME.registerComponent('move-forward-only', {
        init: function () {
            var camera = document.querySelector('#camera');
            var movement = camera.getAttribute('movement-controls');

            // Restreindre les mouvements uniquement en avant (axe Z)
            movement = movement || {};
            movement.acceleration = {x: 0, y: 0, z: 5};  // Avancer uniquement dans l'axe Z
            movement.speed = 3;  // Ajuster la vitesse si nécessaire
            camera.setAttribute('movement-controls', movement);
        }
    });

    // Ajoute ce composant au "rig"
    document.querySelector('#rig').setAttribute('move-forward-only', '');
</script>

</body>
</html>
