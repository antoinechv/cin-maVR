<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Forest Gump</title>
    <script src="https://aframe.io/releases/1.6.0/aframe.min.js"></script>
    <script src="https://unpkg.com/aframe-environment-component/dist/aframe-environment-component.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/c-frame/aframe-extras@7.5.4/dist/aframe-extras.min.js"></script>
</head>
<body>
<a-scene physics="debug: false" fog="type: exponential; color: white; density: 0.2" vr-mode-ui="enabled: true">
    <a-assets>
        <!-- Modèles 3D -->
        <a-asset-item id="Bench" src="./models/Bench.glb"></a-asset-item>
        <a-asset-item id="Valise" src="./models/Valise.glb"></a-asset-item>
        <a-asset-item id="Box" src="./models/Box.glb"></a-asset-item>
        <a-asset-item id="feather-model" src="./models/plume.glb"></a-asset-item>
        <a-asset-item id="pong-model" src="./models/pong.glb"></a-asset-item>
        <a-asset-item id="bateau" src="./models/bateau.glb"></a-asset-item>
    </a-assets>

    <a-sky color="white"></a-sky>

    <!-- Lumières -->
    <a-light type="ambient" color="#ffffff" intensity="0.5"></a-light>

    <!-- Caméra avec contrôle -->
    <a-entity id="rig" joystick-movement position="1 1.6 2" rotation="-20 0 0">
        <a-entity
                camera
                position="0 1.6 0"
                look-controls="pointerLockEnabled: true"
                cursor="rayOrigin: mouse"
        >
            <a-cursor id="cursor" position="0 0 -1" material="color: red; shader: flat;"></a-cursor>
        </a-entity>
    </a-entity>

    <!-- Scène principale -->
    <a-entity>
        <!-- Banc -->
        <a-entity id="Bench"
                  gltf-model="#Bench"
                  position="0.8 1 -5"
                  scale="0.2 0.1 0.1"
                  sound="src: #bench-music; autoplay: true; loop: true; positional: true; distanceModel: linear; refDistance: 4; maxDistance: 12; volume: 0.3">
        </a-entity>

        <!-- Valise -->
        <a-entity id="Valise"
                  gltf-model="#Valise"
                  position="0.8 0.3 -15"
                  rotation="0 120 0"
                  scale="0.4 0.4 0.4"
                  sound="src: #valise-music; autoplay: true; loop: true; positional: true; distanceModel: linear; refDistance: 5; maxDistance: 20; volume: 0.2">
        </a-entity>

        <!-- Boîte de chocolat -->
        <a-entity id="Box"
                  gltf-model="#Box"
                  position="0 1.05 -25"
                  rotation="40 30 0"
                  scale="0.8 0.8 0.8"
                  sound="src: #box-music; autoplay: true; loop: true; positional: true; distanceModel: linear; refDistance: 6; maxDistance: 18; volume: 0.4">
        </a-entity>

        <!-- Plume tombante -->
        <a-entity gltf-model="#feather-model"
                  id="feather1"
                  position="0 5 -35"
                  dynamic-body="mass: 0.1"
                  animation="property: position; to:0 0 -35; dur: 3000; loop: true; dir: normal;">
        </a-entity>

        <!-- Jeu Pong -->
        <a-entity id="Pong"
                  gltf-model="#pong-model"
                  position="0.2 -0.8 -45"
                  scale="0.8 0.8 0.8"
                  rotation="-30 0 0"
                  sound="src: #pong-music; autoplay: true; loop: true; positional: true; distanceModel: linear; refDistance: 4; maxDistance: 15; volume: 0.3">
        </a-entity>

        <!-- Bateau -->
        <a-entity id="bateau"
                  gltf-model="#bateau"
                  position="5 -1 -60"
                  rotation="0 120 0"
                  scale="0.01 0.01 0.01"
                  sound="src: #bateau-music; autoplay: true; loop: true; positional: true; distanceModel: linear; refDistance: 7; maxDistance: 25; volume: 0.4">
        </a-entity>
    </a-entity>

    <audio id="bench-music" src="./audio/theme.mp3" preload="auto"></audio>
    <audio id="box-music" src="./audio/box.mp3" preload="auto"></audio>
    <audio id="valise-music" src="./audio/valise.mp3" preload="auto"></audio>
    <audio id="bateau-music" src="./audio/bateau.MP3" preload="auto"></audio>
    <audio id="pong-music" src="./audio/pong.mp3" preload="auto"></audio>
</a-scene>

<script>
    // Composant personnalisé pour le mouvement avant et arrière avec le joystick
    AFRAME.registerComponent('joystick-movement', {
        schema: {
            speed: {type: 'number', default: 0.1} // Vitesse de déplacement
        },
        init: function () {
            this.joystickInput = {x: 0, y: 0}; // Initialisation des données du joystick

            // Écoute les mouvements du joystick gauche
            this.el.sceneEl.addEventListener('thumbstickmoved', (event) => {
                this.joystickInput = event.detail;
            });
        },
        tick: function () {
            const position = this.el.object3D.position;

            // Se déplacer en avant/arrière (axe Z)
            if (Math.abs(this.joystickInput.y) > 0.1) { // Seuil pour éviter les petits mouvements involontaires
                position.z += this.joystickInput.y * this.data.speed;
            }

            // Mise à jour de la position
            this.el.setAttribute('position', position);
        }
    });
</script>

</body>
</html>
